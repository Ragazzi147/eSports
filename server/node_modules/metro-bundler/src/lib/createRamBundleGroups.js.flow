/**
 * Copyright (c) 2015-present, Facebook, Inc.
 * All rights reserved.
 *
 * This source code is licensed under the BSD-style license found in the
 * LICENSE file in the root directory of this source tree. An additional grant
 * of patent rights can be found in the PATENTS file in the same directory.
 *
 * @flow
 * @format
 */

'use strict';

import type {ModuleTransportLike} from '../shared/types.flow';

function createRamBundleGroups(
  ramGroups: Map<string, Array<string>>,
  allModules: Array<ModuleTransportLike>,
): Map<number, Set<number>> {
  const pathToId = new Map();
  allModules.forEach(m => pathToId.set(m.sourcePath, m.id));

  const out = new Map();

  for (const [path, dependencies] of ramGroups) {
    const id = pathToId.get(path);

    if (!id) {
      continue;
    }

    const deps = dependencies
      .map(dependency => pathToId.get(dependency))
      .filter(Boolean);

    out.set(id, new Set(deps));
  }

  return out;
}

module.exports = createRamBundleGroups;
